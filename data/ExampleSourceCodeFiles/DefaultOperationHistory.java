/Users/user/eclipse.platform.ui/bundles/org.eclipse.core.commands/src/org/eclipse/core/commands/operations/DefaultOperationHistory.java
copyright corporation all rights reserved this program accompanying materials terms eclipse public license accompanies distribution http eclipse org legal epl html contributors corporation initial implementation tasktop technologies bug undo commands java util concurrent modification exception undo history source viewer org eclipse core commands operations java util array list java util collections java util hash map java util iterator java util list java util map org eclipse core commands execution exception org eclipse core commands util tracing org eclipse core runtime assert org eclipse core runtime adaptable org eclipse core runtime progress monitor org eclipse core runtime safe runnable org eclipse core runtime status org eclipse core runtime listener list org eclipse core runtime operation canceled exception org eclipse core runtime safe runner org eclipse core runtime status base implementation operation history linear undo redo model operation undo undone operation redo operation eligible undo undone undo operations considered likewise operation redo redone redo implementations direct undo redo operation strict linear undo enforced operation approver installed prevents undo redo operation undone redone operation undo contexts data structures default operation history entry points modify undo redo history concurrently this default operation history thread friendly implementation outbound notifications operation approval requests occur thread initiated request clients default operation history thread listeners operation approvers receive notifications default operation history prepared receive notifications background thread any access occurring notifications properly techniques client widget library this implementation intended subclassed org eclipse core commands operations operation history org eclipse core commands operations operation approver default operation history operation history this flag set code true code history print code system code notifications history occur this flag debug purposes this flag set code true code history print code system code unexpected condition arises this flag debug purposes this flag set code true code history print code system code undo context disposed this flag debug purposes this flag set code true code history print code system code open close sequence this flag debug purposes this flag set code true code history print code system code operation approved this flag debug purposes list link operation approver listener list operation approver approvers listener list listener list map undo limits context map undo context integer limits collections map hash map undo context integer list link operation history listener listener list operation history listener listeners listener list listener list list operations redo list undoable operation redo list collections list array list undoable operation list operations undo list undoable operation undo list collections list array list undoable operation lock synchronize access undo redo history object undo redo history lock object operation absorbing operations open when null operations executed composite composite operation open composite lock synchronize access open composite object open composite lock object create instance default operation history default operation history override add undoable operation operation assert not null operation middle executing open batching operation operation add context operation batch operation disposed undo redo triggered batching operation assume undo triggered batching operation undo open composite lock open composite null open composite operation open composite add operation check undo limit operation undo redo history lock undo list add operation notify add operation flush redo stack contexts undo context contexts operation contexts contexts length flush redo contexts dispose operation reference operation dispose add approver list operation approvers consulted operation history undo redo allowed proceed this method instance list operation approvers prepared receive operation approval messages background thread any access occurring implementation properly techniques client widget library param approver operation approver approver override add operation approver operation approver approver approvers add approver add listener list operation history listeners notified history operations executed undone redone this method instance list operation history listeners prepared receive notifications background thread any access occurring implementation properly techniques client widget library param listener operation history listener listener org eclipse core commands operations operation history listener org eclipse core commands operations operation history event override add operation history listener operation history listener listener listeners add listener override redo undo context context null context allowed passed undoable operation operation redo operation context operation null operation redo override undo undo context context null context allowed passed undoable operation operation undo operation context operation null operation undo check redo limit adding operation theory redo limit reached redo items transferred undo history limit redo history cleared operation check completeness implementations change time return indicating redo proceed check redo limit undoable operation operation undo context contexts operation contexts contexts length limit limit contexts limit force redo limit contexts limit context limit operation remove context contexts operation contexts length check undo limit adding operation return indicating undo proceed check undo limit undoable operation operation undo context contexts operation contexts contexts length limit limit contexts limit force undo limit contexts limit context limit operation remove context contexts operation contexts length override dispose undo context context flush undo flush redo flush context dispose limit set context flush context tracing print trace flushing context context flush undo context flush redo context limits remove context flush undo flush undo context flush redo flush redo context perform redo all validity checks occurred param monitor param operation status redo progress monitor monitor adaptable info undoable operation operation execution exception status status redo approval operation info status notify about redo operation status operation redo monitor info operation canceled exception status status execution exception notify not operation tracing print trace execution exception redoing operation exception notify not operation tracing print trace exception redoing operation execution exception while redoing operation exception occurred successful operation removed redo history undo history status undo true undo redo history lock redo list remove operation check undo limit operation undo list add operation undo false dispose operation add stack longer reference undo operation dispose notify listeners happen history updated notify redone operation notify not operation status status perform undo all validity checks occurred param monitor param operation status undo progress monitor monitor adaptable info undoable operation operation execution exception status status undo approval operation info status notify about undo operation status operation undo monitor info operation canceled exception status status execution exception notify not operation tracing print trace execution exception operation exception notify not operation tracing print trace exception operation execution exception while operation exception occurred successful operation removed undo history redo history status redo true undo redo history lock undo list remove operation check redo limit operation redo list add operation redo false dispose operation add stack longer reference redo operation dispose notification occurs undo redo histories adjusted notify undone operation notify not operation status status override status execute undoable operation operation progress monitor monitor adaptable info execution exception assert not null operation error operation invalid operation execute operation history check operation approvers status status execute approval operation info status approved notifications status status middle open composite add operation open operation add operation history execute merging false open composite lock open composite null composite shouldn executed explicitly open open composite operation operation history open composite add operation merging true execute operation merging notify about execute operation status operation execute monitor info operation canceled exception status status execution exception notify not operation exception notify not operation execution exception while executing operation exception occurred successful notify listeners notified operation history merging status notify done operation add operation notify not operation status dispose operation add stack longer reference operation dispose severities interpreted simply status status filter list include undo context undoable operation filter list undoable operation list undo context context this method filter undo redo history context currently caches optimize repeated requests filter benchmarks common pattern performances problems implement filtered cache nullified global history list undoable operation filtered array list undo redo history lock iterator undoable operation iterator list iterator iterator next undoable operation operation iterator operation context context filtered add operation filtered array undoable operation filtered size flush redo stack operations context flush redo undo context context tracing print trace flushing redo history context undo redo history lock object filtered filter redo list context filtered length undoable operation operation undoable operation filtered context operation contexts length remove operation context flushing redo list remove operation internal remove operation remove reference context see https bugs eclipse org bugs bug cgi simply remove context there contexts match dispose undo context contexts operation contexts contexts length contexts matches context operation remove context contexts operation contexts length redo list remove operation internal remove operation flush undo stack operations context flush undo undo context context tracing print trace flushing undo history context undo redo history lock get operations context matches object filtered filter undo list context filtered length undoable operation operation undoable operation filtered context operation contexts length remove operation context flushing undo list remove operation internal remove operation remove reference context see https bugs eclipse org bugs bug cgi simply remove context there contexts match dispose undo context contexts operation contexts contexts length contexts matches context operation remove context contexts operation contexts length undo list remove operation internal remove operation there open composite context context removed context flushing operations null notify don remove composite operation ended composite null open composite lock open composite null open composite context context context open composite contexts length ended composite open composite open composite null open composite remove context context notify block ended composite null notify not ended composite force redo history context max items force redo limit undo context context max undo redo history lock object filtered filter redo list context size filtered length size size max undoable operation removed undoable operation filtered context removed contexts length remove operation enforcing global limit operation context redo list remove removed internal remove removed operation multiple contexts reached limit remove context operation removed remove context context size force undo history context max items force undo limit undo context context max undo redo history lock object filtered filter undo list context size filtered length size size max undoable operation removed undoable operation filtered context removed contexts length remove operation enforcing global limit operation context undo list remove removed internal remove removed operation multiple contexts reached limit remove context operation removed remove context context size override limit undo context context limits key context limits context value consult operation approvers proposed redo allowed status redo approval undoable operation operation adaptable info operation approver approver approvers status approval approver proceed redoing operation info approval tracing print trace redo approved approver operation operation approved approval approval status override undoable operation redo history undo context context assert not null context filter redo list context override undoable operation redo operation undo context context assert not null context undo redo history lock redo list size undoable operation operation redo list operation context context operation null consult operation approvers proposed undo allowed status undo approval undoable operation operation adaptable info operation approver approver approvers status approval approver proceed undoing operation info approval tracing print trace undo approved approver operation operation status approval approval status override undoable operation undo history undo context context assert not null context filter undo list context override undoable operation undo operation undo context context assert not null context undo redo history lock undo list size undoable operation operation undo list operation context context operation null consult operation approvers proposed execution allowed status execute approval undoable operation operation adaptable info operation approver tmp approvers tmp operation approver operation approver approver operation approver tmp status approval approver proceed executing operation info approval tracing print trace execute approved approver operation operation status approval approval status remove operation disposing notifying listeners internal remove undoable operation operation operation dispose notify removed operation notify listeners operation event notify listeners operation history event event event operation advanced undoable operation advanced undoable operation advanced advanced undoable operation event operation safe runner safe runnable override handle exception throwable exception tracing print trace exception notification callback exception override exception advanced notify event operation history listener listener listeners safe runner safe runnable override handle exception throwable exception tracing print trace exception notification callback exception override exception listener history notification event notify about execute undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation redo notify about redo undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation undo notify about undo undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation notify add undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation executing notify done undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation succeed attempt execute undo redo notify not undoable operation operation notify not operation null notify listeners operation succeed attempt execute undo redo include status attempt notify not undoable operation operation status status tracing print trace operation notify listeners operation history event operation history event operation status notify listeners operation redone notify redone undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation removed history notify removed undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation undone notify undone undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation notify listeners operation undone notify changed undoable operation operation tracing print trace operation notify listeners operation history event operation history event operation override status redo undo context context progress monitor monitor adaptable info execution exception assert not null context undoable operation operation redo operation context info operation operation null operation history error operation invalid operation redo tracing print trace redo operation valid operation operation history redo monitor info operation override status redo operation undoable operation operation progress monitor monitor adaptable info execution exception assert not null operation status status operation redo status redo monitor info operation tracing print trace redo operation valid operation status operation history status override remove operation approver operation approver approver approvers remove approver override remove operation history listener operation history listener listener listeners remove listener override replace operation undoable operation operation undoable operation replacements check undo history undo false undo redo history lock undo list operation undo true undo list remove operation notify listeners lock undo list released array list undo context contexts array list replacements length replacements length undo context contexts replacements contexts contexts length contexts add contexts undo list add replacements notify listeners lock history released recheck limits doesn change replacement contexts size undo context context contexts force undo limit context limit context undo notify listeners operations removed internal remove operation replacements length notify add replacements operation undo history check redo history undo redo history lock redo list operation array list undo context contexts array list replacements length redo list remove operation notify listeners release lock redo list replacements length undo context contexts replacements contexts contexts length contexts add contexts redo list add replacements notify listeners release lock redo list recheck limits doesn change replacement contexts size undo context context contexts force redo limit context limit context send listener notifications release lock history internal remove operation replacements length notify add replacements override set limit undo context context limit assert true limit limit checking methods interpret null context global limit enforced support global limit implementation exception null context rest implementation handle null context subclasses override global limit desired assert not null context limits context integer limit undo redo history lock force undo limit context limit force redo limit context limit override status undo undo context context progress monitor monitor adaptable info execution exception assert not null context undoable operation operation undo operation context info operation operation null operation history error operation invalid operation undo tracing print trace undo operation valid operation operation history undo monitor info operation override status undo operation undoable operation operation progress monitor monitor adaptable info execution exception assert not null operation status status operation undo status undo monitor info operation tracing print trace undo operation valid operation status operation history status override open operation composite operation operation mode open composite lock open composite null open composite operation unexpected nesting operations tracing print trace open operation called operation open open composite operation illegal state exception cannot open operation open open composite operation tracing print trace opening operation open composite mode notify about execute open composite override close operation operation add history mode composite operation ended composite null open composite lock open composite null tracing print trace attempted close operation open notifications occur synchonized block open composite null tracing print trace closing operation open composite ended composite open composite open composite null mode triggered request undo redo history undo redo notification occur sequence ended composite null operation mode notify done ended composite add history add ended composite mode notify not ended composite override operation changed undoable operation operation undo list operation redo list operation notify changed operation